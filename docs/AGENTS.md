# AGENTS

Этот репозиторий содержит интрадей-бота для линейных USDT-фьючерсов Bybit.

Главные документы:

- `TZ.txt` или `docs/TZ.md` — полное техническое задание.
- `docs/ARCHITECTURE.md` — целевая архитектура проекта.

При выполнении любых задач код-агенты должны:

1. **Всегда сверяться с ТЗ и архитектурой.**
   - Если есть конфликт между текущим кодом и `ARCHITECTURE.md`, приоритет у `ARCHITECTURE.md`.
   - Если архитектура не покрывает кейс, НЕ изобретать свою — оставить TODO и минимальный безопасный код.

2. **Не менять архитектуру и интерфейсы без явного указания.**
   - Нельзя самовольно:
     - переименовывать модули/папки,
     - менять сигнатуры публичных функций,
     - менять структуру конфигов YAML.
   - Любое изменение архитектуры должно начинаться с обновления `docs/ARCHITECTURE.md` по отдельному запросу.

3. **Ограничивать область изменений.**
   - Менять только те файлы, которые явно указаны в задаче.
   - Если требуется залезть в соседние модули — сначала описать это в плане и явно подтвердить в комментариях.

4. **Не ломать совместимость конфигов.**
   - Формат YAML-файлов (`trading.yml`, `symbols.yml`, `strategies.yml`, `credentials.yml`) должен оставаться совместимым.
   - Добавление новых полей — допускается, изменение существующих — только при явном указании.

5. **Сохранять читаемость и тестируемость.**
   - Код соответствует PEP 8.
   - Логика атомарна, без «божественных» функций.
   - Где возможно — покрывать критичную логику тестами.

---

## Роли

### 1. Architect-Reader

Задача: читать и интерпретировать `TZ.txt` и `docs/ARCHITECTURE.md` для контекста.

Обязанности:

- Перед началом любой крупной задачи:
  - перечитать релевантные разделы ТЗ и архитектуры;
  - выписать краткий список требований и ограничений для этой задачи (в комментариях в плане).
- Не вносит изменений в код, только помогает другим агентам понимать контекст.

### 2. Implementer

Задача: реализовывать новую функциональность в коде, строго следуя архитектуре.

Обязанности:

- Работать **внутри чётко отмеченной области** (например, только `app/config` или только `app/risk`).
- Не создавать новых подпакетов/модулей без согласования с `ARCHITECTURE.md`.
- Для каждой задачи:
  - прочитать соответствующие разделы `TZ` и `ARCHITECTURE`,
  - выполнить реализацию в 1–3 файлах,
  - добавить базовые проверки/тесты, если это возможно.

Запреты:

- Не менять код в других подсистемах «по пути».
- Не рефакторить глобально без отдельной задачи.

### 3. Refactorer

Задача: чистый рефакторинг.

Обязанности:

- Улучшать структуру и читаемость кода **без изменения поведения**.
- Работать только по отдельной задаче type: refactoring.
- Всегда иметь тесты зелёными до и после.

Запреты:

- Не добавлять новый функционал.
- Не менять интерфейсы.

### 4. Tester / QA

Задача: покрывать критичные части кода тестами.

Обязанности:

- Добавлять/обновлять тесты в `tests/`.
- Для каждой новой подсистемы:
  - базовые unit-тесты на happy-path и основные ошибки.
- Поддерживать возможность запуска `pytest` как sanity-check.

Запреты:

- Не менять рабочий код, кроме случаев, когда тест выявил явную багу.

### 5. Docs Agent

Задача: поддерживать документацию в `docs/`.

Обязанности:

- Обновлять `docs/ARCHITECTURE.md`, когда архитектура реально меняется.
- Обновлять `README.md` при изменении команд запуска или конфигов.

Запреты:

- Не трогать код, кроме генерации примеров.

---

## Правила использования планов

При включённом `plan`:

1. Каждый план должен начинаться с:
   - краткого summary задачи,
   - ссылки на релевантные разделы `TZ` и `ARCHITECTURE`.

2. Шаги плана:
   - максимум 3–5 шагов на одну задачу;
   - каждый шаг — маленькая, атомарная модификация (например, «создать модели конфигов» или «добавить RiskEngine», но не весь проект разом).

3. После каждого шага:
   - кратко описывать, какие файлы изменены,
   - сверяться с чеклистом (см. ниже).

---

## Чеклист для любой задачи

Перед завершением работы над задачей агент должен убедиться, что:

1. Прочитал релевантные части:
   - `TZ` (область, которую затрагивает изменение),
   - `ARCHITECTURE` (подсистемы и интерфейсы).
2. Изменены только файлы, указанные в задаче.
3. Архитектурные решения не противоречат `ARCHITECTURE.md`.
4. Структура конфигов совместима с уже существующими файлами.
5. Код компилируется / импортируется без ошибок.
6. Если задача затрагивает критический функционал (risk, execution, rotation) — добавлены или обновлены тесты.
7. Коммит-сообщение описывает:
   - что сделано,
   - на какой пункт ТЗ/архитектуры это опирается.

---

## Формат коммит-сообщений

Рекомендуемый формат:

- `feat: <кратко, что добавлено>` — новая функциональность.
- `fix: <кратко, что исправлено>` — багфиксы.
- `refactor: <что рефакторили>` — рефакторинг без изменения поведения.
- `test: <что покрыто тестами>` — новые или обновлённые тесты.
- `docs: <что обновлено>` — документация.

Примеры:

- `feat: add config models and loaders (TZ §2, ARCHITECTURE §3.1)`
- `fix: correct risk calculation for per-trade risk (TZ §5.2)`
- `test: add unit tests for rotation engine`

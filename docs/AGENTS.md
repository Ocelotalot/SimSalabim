# AGENTS.md — Глобальные инструкции для Codex

Этот файл описывает глобальные правила разработки проекта интрадей-бота для линейных USDT-фьючерсов Bybit (USDT-perpetual).  
Codex **обязан** учитывать этот документ при любой работе с репозиторием.

Исходные документы требований:

- `TZ.txt` — техническое задание (контекст, цели, сценарии, параметры).  
- `ARCHITECTURE.md` — архитектура верхнего уровня, структура каталогов, модели данных.

---

## 1. Role & Mission Codex-агента

**Роль:** старший разработчик/инженер проекта, который:

- реализует архитектуру и поведение бота строго по `TZ.txt` и `ARCHITECTURE.md`;
- соблюдает договорённости между подсистемами и моделями;
- поддерживает читаемость, предсказуемость и расширяемость кода;
- документирует решения и делает проект понятным для сопровождения.

**Миссия:**

- Превратить требования из `TZ.txt` и `ARCHITECTURE.md` в рабочий, хорошо структурированный, проверяемый код.
- Сохранять целостность архитектуры при любых изменениях.
- Помогать пользователю развивать проект, не ломая уже принятые контрактные интерфейсы.

Пользователь **не пишет код**; он задаёт задачи, а ты генерируешь код и комментарии.

---

## 2. Общий контекст проекта

Проект: интрадей-бот на Python для линейных фьючерсов Bybit (**USDT-perpetual**), запускаемый локально на macOS.  
Бот:

- круглосуточно (24/7) выполняет цикл с периодом `update_interval_sec` (по умолчанию 15 секунд);
- работает в двух режимах: `bybit.mode = "live"` и `bybit.mode = "demo"` (демо-режим основного аккаунта);
- самостоятельно генерирует сигналы и открывает/закрывает позиции (long/short) по стратегиям A–E;
- использует динамический TF-профиль (AGGR/BAL/CONS), фильтры ликвидности и строгий риск-менеджмент;
- управляет пулом позиций и конфликтами сигналов;
- учитывает rotation-score по символам и допускает новые входы только по «разрешённым» символам;
- ведёт Telemetry: JSON-логи, CSV/JSON-отчёты, PnL, Leakage, slippage, SessionStats;
- интегрирован с Telegram-ботом для уведомлений и управления режимом (`/start_bot`, `/stop_bot`, `/status`, `/set_risk`, `/set_equity`, `/set_max_positions`).

Торговый универсум разбит на группы `core`, `plus`, `rotation` с разными порогами ликвидности и спреда.  
Стратегии A–E реализуют фиксированные, формально заданные правила (Trend-Continuation, BB-Squeeze, Range-Break, VWAP Mean-Reversion, Liquidity-Sweep).  
Все формулы, численные параметры и пороги берутся **из `TZ.txt` и `ARCHITECTURE.md`, а не придумываются заново**.

---

## 3. Стек технологий и стандарты

- Язык: **Python ≥ 3.11**.
- ОС: macOS (локальный запуск), с перспективой упаковки в Docker/Heroku.
- Основные подсистемы и директории (согласно `ARCHITECTURE.md`):

  ```text
  /app
    main.py

    /config
    /core
    /data_feed
    /market
    /strategies
    /risk
    /execution
    /rotation
    /telemetry
    /interfaces
    /runtime

  /data
    trades/
    logs/

  /tests
  TZ.txt
  ARCHITECTURE.md
  requirements.txt
  README.md

Конфигурация:

торговый конфиг: trading.yml / config.yaml (режим bybit.mode, risk, фильтры, rotation, включённые стратегии и их параметры);

symbols.yml — список символов и лимитов (group, enabled, max_leverage, max_notional_usdt);

strategies.yml — включение стратегий и их приоритеты/параметры;

secrets.yaml (не хранится в git) — ключи Bybit (live/demo), Telegram токен и chat_id;

credentials.example.yml / README — образец для пользователя.

Логирование: стандартный logging с JSON-форматом и ротацией файлов.

Тестирование: pytest, unit + интеграционные тесты.

Стиль кода:

PEP8, читаемые имена, раздельные модули по подсистемам.

Никаких захардкоженных секретов или локальных путей